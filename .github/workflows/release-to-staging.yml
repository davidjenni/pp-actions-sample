name: release-to-staging

on:
  pull_request:
    branches: [ main ]
  workflow_run:
      workflows: ["convert-to-managed"]

jobs:
  build:
    runs-on: windows-latest
    env:
      RUNNER_DEBUG: 1

    steps:
    - uses: actions/checkout@v2
      with:
        lfs: true

    - name: Fetch the ready to ship solution from GH artifact store
      uses: actions/download-artifact@v2
      with:
        name: managedSolutions
        path: out/release/Covid19Screening.zip

    - run: dir .\out\release

    # - name: Import solution to staging env
    #   # uses: microsoft/powerplatform-actions/import-solution@v0
    #   uses: ./microsoft/powerplatform-actions/import-solution
    #   with:
    #     # TODO: switch url to the test/staging one
    #     environment-url: 'https://user9-build.crm.dynamics.com/'
    #     user-name: 'user9@wrkdevops.onmicrosoft.com'
    #     password-secret: ${{ secrets.password }}
    #     solution-file: out/release/Covid19Screening.zip
    #     force-overwrite: true
    #     publish-changes: true
